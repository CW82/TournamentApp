<table border="1">
    <thead>
        <tr>
            <th>Match Teams ID</th>
            <th>Match ID</th>
            <th>Team ID</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {{#each matchTeams}}
        <tr data-id="{{matchTeamsID}}">
            <td>{{matchTeamsID}}</td>
            <td class="matchID">{{matchID}}</td>
            <td class="teamName">{{teamID}} ({{teamName}})</td>
            <td>
                <div class="action-buttons">
                    <button class="edit-btn">Edit</button>
                    <form action="/matchTeams/delete/{{matchTeamsID}}" method="POST" class="delete-button" style="display:inline">
                        <button type="submit" onclick="return confirmDelete('{{matchTeamsID}}')">Delete</button>
                    </form>
                </div>
            </td>
        </tr>
        {{/each}}
    </tbody>
</table>

<form action="/matchTeams/add" method="POST" class="add-form">
    <h3>Add New Match Team</h3>
    <div class="form-row">
        <select name="matchID" required>
            <option value="" disabled selected>Select Match</option>
            {{#each matches}}
                <option value="{{matchID}}">Match {{matchID}}</option>
            {{/each}}
        </select>
        <select name="teamID" required>
            <option value="" disabled selected>Select Team</option>
            {{#each teams}}
                <option value="{{teamID}}">{{teamName}} (ID: {{teamID}})</option>
            {{/each}}
        </select>
        <button type="submit">Add Match Team</button>
    </div>
</form>

<!-- team options template -->
<script id="team-options" type="text/template">
    {{#each teams}}
        <option value="{{teamID}}">{{teamName}} (ID: {{teamID}})</option>
    {{/each}}
</script>

<!-- match options template -->
<script id="match-options" type="text/template">
    {{#each matches}}
        <option value="{{matchID}}">Match {{matchID}}</option>
    {{/each}}
</script>

<script>
function confirmDelete(id) {
    return confirm(`Are you sure you want to delete "${id}"?`);
}

document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const row = btn.closest('tr');
            const id = row.dataset.id;

            // If already in edit mode, do nothing
            if (row.querySelector('input')) return;

            const matchID = row.querySelector('.matchID').textContent;
            const teamName = row.querySelector('.teamName').textContent;

            // Replace cells with input fields
            row.querySelector('.matchID').innerHTML = `<input type="number" name="matchID" value="${matchID}">`;
            row.querySelector('.teamName').innerHTML = `<input type="number" name="teamID" value="${teamName.match(/\d+/)[0]}">`;

            // Replace Edit button with Save button
            const saveBtn = document.createElement('button');
            saveBtn.type = 'button';
            saveBtn.textContent = 'Save';
            btn.replaceWith(saveBtn);

            saveBtn.addEventListener('click', async () => {
                const data = new URLSearchParams();
                data.append('matchID', row.querySelector('input[name="matchID"]').value);
                data.append('teamID', row.querySelector('input[name="teamID"]').value);

                const response = await fetch(`/matchTeams/update/${id}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: data.toString()
                });

                if (response.ok) {
                    window.location.reload();
                } else {
                    alert('Error updating matchTeam');
                }
            });
        });
    });
});
</script>
