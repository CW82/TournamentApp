<table border="1">
    <thead>
        <tr>
            <th>tournamentID</th>
            <th>tournamentName</th>
            <th>gameID</th>
            <th>prizeMoney</th>
            <th>location</th>
            <th>startDate</th>
            <th>endDate</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {{#each tournaments}}
        <tr data-tournamentid="{{tournamentID}}">
            <td>{{tournamentID}}</td>
            <td class="tournamentName">{{tournamentName}}</td>
            <td class="gameID">{{gameID}} ({{gameTitle}})</td>
            <td class="prizeMoney">{{prizeMoney}}</td>
            <td class="location">{{location}}</td>
            <td class="startDate">{{startDate}}</td>
            <td class="endDate">{{endDate}}</td>
            <td>
                <div class="action-buttons">
                    <button class="edit-btn">Edit</button>
                    <form method="POST" class="delete-button" action="/tournaments/delete/{{tournamentID}}" style="display:inline">
                        <button type="submit" onclick="return confirmDelete('{{tournamentName}}')">Delete</button>
                    </form>
                </div>
            </td>
        </tr>
        {{/each}}
    </tbody>
</table>

<form action="/tournaments/add" method="POST" class="add-form">
    <h3>Add New Tournaments</h3>
    <div class="form-row">
        <input type="text" name="tournamentName" placeholder="Tournament Name" required>
        <select name="gameID" required>
            <option value="" disabled selected>Select Game</option>
            {{#each games}}
                <option value="{{gameID}}">{{title}} (ID: {{gameID}})</option>
            {{/each}}
        </select>
        <input type="text" name="prizeMoney" placeholder="Prize Money" required>
        <input type="text" name="location" placeholder="Location" required>
        <input type="date" name="startDate" required>
        <input type="date" name="endDate" required>
        <button type="submit">Add Tournament</button>
    </div>
</form>

<script>
    const games = [
        {{#each games}}
            { gameID: {{gameID}}, title: "{{title}}" },
        {{/each}}
    ];
</script>

<script>
document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            const row = btn.closest('tr');
            const id = row.dataset.tournamentid;
            if (row.querySelector('input')) return;

            const cells = ['tournamentName','gameID','prizeMoney','location','startDate','endDate'];
            cells.forEach(c => {
                const val = row.querySelector(`.${c}`).textContent;
                const type = c.includes('Date') ? 'date' : 'text';
                row.querySelector(`.${c}`).innerHTML = `<input type="${type}" name="${c}" value="${val}">`;
            });

            const saveBtn = document.createElement('button');
            saveBtn.textContent = 'Save';
            saveBtn.type = 'button';
            btn.replaceWith(saveBtn);

            saveBtn.addEventListener('click', async () => {
                const formData = new URLSearchParams();
                cells.forEach(c => formData.append(c, row.querySelector(`input[name="${c}"]`).value));

                const response = await fetch(`/tournaments/update/${id}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                    body: formData.toString()
                });

                if (response.ok) window.location.reload();
                else alert('Error updating tournament');
            });
        });
    });
});
</script>
